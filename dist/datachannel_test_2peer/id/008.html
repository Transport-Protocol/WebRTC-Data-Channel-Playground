<!DOCTYPE html>
<html lang="en" class="a">
	<head>
		<meta charset="utf-8">
		<!-- Testharness Timeout to long -> 60 Seconds-->
		<meta name="timeout" content="long">
		<title>WebRTC - ID Test</title>
		<script src="../resources/testharness.js"></script>
		<script src="../resources/testharnessreport.js"></script><link href="../resources/testharness.css" type="text/css" rel="stylesheet"/>
		<!-- Including the Firebase.js to send the ICE Candidate to the other peer-->
		<script type="text/javascript" src='https://cdn.firebase.com/v0/firebase.js'></script>
	</head>
	<body class="a">
		<div>
			<div id="signallingInfo"></div>
			
				
			
		</div>
		<hr />

		<!-- Testharness log -->
		<div id="log"></div>
		<script src="../datachannel2peers.js" type="text/javascript"></script>
		<script type="text/javascript">
            var label = "test";
            var dataChannel = new Array();
            var dataChannelOptions = {
            	id : 0
            };
            var max = 1024;
            var test = async_test("Set up " + (max) + " DataChannels -  with specific id - starts with id 0 then increase by one ");
            if (offerer) {
                test.step(function() {
                   for(var i = 0; i< max; i++){
						dataChannel[i] =peerConnection.createDataChannel(label, dataChannelOptions);
						console.log("create " + i);
						dataChannelOptions.id = (i+1);
						if(i == (max-1)){
							dataChannel[i].onopen= test.step_func(function(e) {
								console.log(i + "Channels " + dataChannel.length);
								test.done();
							});
						}
					}
                });
            } else {
            	var j = 0;
                peerConnection.ondatachannel = test.step_func(function(e) {
                	console.log("j " +j);
                    dataChannel[j] = e.channel;
                    if(j == (max-1)){
                    	dataChannel[j].onopen = test.step_func(function() {
	                        console.log(j + "Channels " + dataChannel.length);
	                        test.done();
	                    });
                    }
                    j++;
                });
            }
		</script>
	</body>
</html>